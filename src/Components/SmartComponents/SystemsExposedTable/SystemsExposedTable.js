import { Alert, Badge, Button, Grid, GridItem } from '@patternfly/react-core';
import { Ansible, Pagination, Table } from '@red-hat-insights/insights-frontend-components';
import propTypes from 'prop-types';
import React from 'react';
import WithLoader from '../../PresentationalComponents/WithLoader/WithLoader';
import './SystemsExposedTable.scss';

class SystemsExposedTable extends React.Component {
    constructor(props) {
        super(props);
        this.checkItem = this.checkItem.bind(this);
        this.state = {
            systemList: []
        };
    }

    static getDerivedStateFromProps(props) {
        return { systemList: props.affectedBy.content };
    }

    getSelectedCount() {
        if (this.state.systemList) {
            let selected = this.state.systemList.filter(item => item.selected === true);
            return selected.length;
        }

        return [];
    }

    checkItem(key, value) {
        let newList = this.state.systemList;
        newList[key].selected = value;
        this.setState({ systemList: newList });
    }
    render() {
        return (
            <React.Fragment>
                <Grid gutter="sm">
                    <WithLoader isLoading={this.props.affectedBy.isLoading}>
                        <GridItem span={12}>
                            <Alert
                                variant={this.state.systemList.length === 0 ? 'success' : 'warning'}
                                title={'Number of affected systems: ' + this.state.systemList.length}
                            />
                        </GridItem>
                        <GridItem span={12} style={this.state.systemList.length === 0 ? { display: 'none' } : {}}>
                            <Pagination
                                numberOfItems={this.state.systemList.length}
                                itemsPerPage={50}
                            />
                            <Table
                                className="systems-exposed-table"
                                header={['Type', 'Name', '']}
                                rows={this.state.systemList}
                                hasCheckbox={true}
                                onItemSelect={(event, key, value) => this.checkItem(key, value)}
                            />
                        </GridItem>
                        <GridItem style={this.state.systemList.length === 0 ? { display: 'none' } : {}}>
                            <Grid gutter="sm">
                                <GridItem span={9}>
                                    Systems selected: <Badge isRead={true}>{this.getSelectedCount()}</Badge>
                                </GridItem>
                                <GridItem span={3}>
                                    <Grid gutter="sm">
                                        <GridItem span={6}>
                                            <a download href="../common/AnsiblePlaybook.yml">
                                                <Button
                                                    className={'actionButtons'}
                                                    variant="secondary"
                                                    isDisabled={this.getSelectedCount() === 0}
                                                >
                                                    <Ansible style={{ paddingTop: '3px' }} />
                                                    <span className="icon-label">Generate Playbook</span>
                                                </Button>
                                            </a>
                                        </GridItem>
                                        <GridItem span={6}>
                                            <Button
                                                className={'actionButtons'}
                                                variant="secondary"
                                                isDisabled={this.getSelectedCount() === 0}
                                            >
                                                Add to plan
                                            </Button>
                                        </GridItem>
                                    </Grid>
                                </GridItem>
                            </Grid>
                        </GridItem>
                    </WithLoader>
                </Grid>
            </React.Fragment>
        );
    }
}
SystemsExposedTable.propTypes = {
    history: propTypes.object,
    affectedBy: propTypes.object
};

export default SystemsExposedTable;
