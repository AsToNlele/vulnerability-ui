import React, { Component } from 'react';
import { withRouter } from 'react-router-dom';
import { Button } from '@patternfly/react-core';
import { PageHeader } from '@red-hat-insights/insights-frontend-components';
import { PageHeaderTitle } from '@red-hat-insights/insights-frontend-components';
import { Section } from '@red-hat-insights/insights-frontend-components';
import { connect } from 'react-redux';
import propTypes from 'prop-types';

class CVEPage extends Component {
    constructor(props) {
        super(props);
        this.state = {
            synopsis: window.location.pathname.split('/').slice(-1)[0],
            cveDetails: {}
        };
    }

    componentDidMount() {
        let singleCve = this.props.cveList.find(item => {
            return item.key === this.state.synopsis;
        });
        this.setState({ cveDetails: singleCve.props });
    }

    render() {
        return (
            <div className="pf-l-stack">
                <div className="pf-l-stack__item pf-m-secondary ">
                    <PageHeader>
                        <PageHeaderTitle title={this.state.synopsis} />
                    </PageHeader>
                </div>
                <div className="pf-l-stack__item pf-m-secondary ">
                    <Section type="content">
                        <div className="pf-l-grid pf-m-gutters">
                            <div className="pf-l-grid__item pf-m-6-col">
                                <div className="pf-c-card ">
                                    <div className="pf-c-card__header ">
                                        <h6 className="pf-c-title pf-m-xl pf-m-margin">
                                            <i className="fas fa-exclamation-circle" /> Details
                                        </h6>
                                    </div>
                                    <div className="pf-c-card__body ">
                                        <table border="0" className="content-table">
                                            <tbody>
                                                <tr>
                                                    <td>Synopsis:</td>
                                                    <td>{this.state.cveDetails.synopsis}</td>
                                                </tr>
                                                <tr>
                                                    <td>Impact:</td>
                                                    <td>{this.state.cveDetails.impact}</td>
                                                </tr>
                                                <tr>
                                                    <td>Cvss3 Score:</td>
                                                    <td>{this.state.cveDetails.cvss3_score}</td>
                                                </tr>
                                                <tr>
                                                    <td>CWE:</td>
                                                    <td>{this.state.cveDetails.cwe_list}</td>
                                                </tr>
                                                <tr>
                                                    <td>URL:</td>
                                                    <td>
                                                        <a href={this.state.cveDetails.redhat_url}>
                                                            {this.state.cveDetails.redhat_url}
                                                        </a>
                                                        <br />
                                                        <a href={this.state.cveDetails.secondary_url}>
                                                            {this.state.cveDetails.secondary_url}
                                                        </a>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td>Public date:</td>
                                                    <td>{this.state.cveDetails.public_date}</td>
                                                </tr>
                                                <tr>
                                                    <td>Modified date:</td>
                                                    <td>{this.state.cveDetails.modified_date}</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                                <Button variant="tertiary" onClick={this.props.history.goBack}>
                                    Back to CVE List
                                </Button>
                            </div>
                            <div className="pf-l-grid__item pf-m-6-col">
                                <div className="pf-c-card ">
                                    <div className="pf-c-card__header ">
                                        <h6 className="pf-c-title pf-m-xl pf-m-margin">Description</h6>
                                    </div>
                                    <div className="pf-c-card__body ">{this.state.cveDetails.description}</div>
                                </div>
                            </div>
                        </div>
                    </Section>
                </div>
            </div>
        );
    }
}

function mapStateToProps(state) {
    return {
        cveList: state.cveList.cveList
    };
}

CVEPage.propTypes = {
    cveList: propTypes.array,
    history: propTypes.object
};

export default withRouter(
    connect(
        mapStateToProps,
        null
    )(CVEPage)
);
