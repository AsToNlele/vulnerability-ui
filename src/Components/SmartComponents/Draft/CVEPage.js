import React, {Component} from 'react';
import {Alert} from '@red-hat-insights/insights-frontend-components';
import {RouteComponentProps as RouteProps, withRouter} from 'react-router-dom';
import {Button} from '@patternfly/react-core';
import {Card} from '@red-hat-insights/insights-frontend-components';
import {CardContent} from '@red-hat-insights/insights-frontend-components';
import {CardFooter} from '@red-hat-insights/insights-frontend-components';
import {CardHeader} from '@red-hat-insights/insights-frontend-components';
import {PageHeader} from '@red-hat-insights/insights-frontend-components';
import {PageHeaderTitle} from '@red-hat-insights/insights-frontend-components';
import {PF3Button} from '@red-hat-insights/insights-frontend-components';
import {Section} from '@red-hat-insights/insights-frontend-components';
import ContentTable, {getExample} from "Components/SmartComponents/ContentTable/ContentTable";
import {fetchCVEList} from "Api/VMaaS/getCves";
import {connect} from "react-redux";


class CVEPage extends Component<RouteProps<any> & Props, State> {
    constructor(props) {
        super(props);
        this.state = {
            synopsis: window.location.pathname.split('/').slice(-1)[0],
            cve_details: {}
        }
    }

    componentWillReceiveProps({cveList}) {
        var singleCve = cveList.find((item) => {
                return item.key === this.state.synopsis;
            }
        );
        this.setState({cve_details: singleCve.props});
    }

    componentDidMount() {
        this.props.fetchData();
    }

    render() {
        return (
            <div className='pf-l-stack'>
                <div className='pf-l-stack__item pf-m-secondary '>
                    <PageHeader>
                        <PageHeaderTitle title={this.state.synopsis}/>
                    </PageHeader>

                </div>
                <div className='pf-l-stack__item pf-m-secondary '>
                    <Section type='content'>
                        <div className="pf-l-grid pf-m-gutters">
                            <div className="pf-l-grid__item pf-m-6-col">

                                <div className="pf-c-card ">
                                    <div className="pf-c-card__header ">
                                        <h6 className="pf-c-title pf-m-xl pf-m-margin"><i
                                            className="fas fa-exclamation-circle"></i> Details</h6>
                                    </div>
                                    <div className="pf-c-card__body ">
                                        <table border="0" className='content-table' style={{minWidth: "100%"}}>
                                            <tbody>
                                            <tr>
                                                <td>Synopsis:</td>
                                                <td>{this.state.cve_details.synopsis}</td>
                                            </tr>
                                            <tr>
                                                <td>Impact:</td>
                                                <td>{this.state.cve_details.impact}</td>
                                            </tr>
                                            <tr>
                                                <td>Cvss3 Score:</td>
                                                <td>{this.state.cve_details.cvss3_score}</td>
                                            </tr>
                                            <tr>
                                                <td>CWE:</td>
                                                <td>{this.state.cve_details.cwe_list}</td>
                                            </tr>
                                            <tr>
                                                <td>URL:</td>
                                                <td><a
                                                    href={this.state.cve_details.redhat_url}>{this.state.cve_details.redhat_url}</a><br/>
                                                    <a href={this.state.cve_details.secondary_url}>{this.state.cve_details.secondary_url}</a>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>Public date:</td>
                                                <td>{this.state.cve_details.public_date}</td>
                                            </tr>
                                            <tr>
                                                <td>Modified date:</td>
                                                <td>{this.state.cve_details.modified_date}</td>
                                            </tr>
                                            </tbody>
                                        </table>
                                    </div>

                                </div>
                                <Button variant='tertiary' onClick={() => { this.props.history.push('/vulnerabilities/')}}> Back to CVE List </Button>
                            </div>
                            <div className="pf-l-grid__item pf-m-6-col">
                                <div className="pf-c-card ">
                                    <div className="pf-c-card__header ">
                                        <h6 className="pf-c-title pf-m-xl pf-m-margin">Description</h6>
                                    </div>
                                    <div className="pf-c-card__body ">
                                        {this.state.cve_details.description}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </Section>
                </div>
            </div>
        );
    }
}

function mapStateToProps(state) {
    return ({
        cveList: state.cveList.cveList,
    })

}

const mapDispatchToProps = (dispatch) => {
    return {
        fetchData: () => dispatch(fetchCVEList())
    }
};
export default withRouter(connect(mapStateToProps, mapDispatchToProps)(CVEPage));
