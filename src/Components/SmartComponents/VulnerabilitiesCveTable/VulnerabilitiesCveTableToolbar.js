import { Checkbox, Form, FormGroup, Select, SelectOption, Toolbar, ToolbarGroup, ToolbarItem } from '@patternfly/react-core';
import { DownloadIcon } from '@patternfly/react-icons';
import { routerParams, SimpleTableFilter } from '@red-hat-insights/insights-frontend-components';
import propTypes from 'prop-types';
import React from 'react';
import { connect } from 'react-redux';
import { dataShape } from '../../../Helpers/MiscHelper';
import './VulnerabilitiesCveTable.scss';

class VulnerabilitiesCveTableToolbar extends React.Component {
    constructor(props) {
        super(props);
        this.changeFilterValue = this.changeFilterValue.bind(this);
        this.changeCVSSValue = this.changeCVSSValue.bind(this);
        this.changeDateValue = this.changeDateValue.bind(this);
        this.changeDateValue = this.changeDateValue.bind(this);
        this.apply = this.apply.bind(this);
        this.state = {
            defaultConfig: {
                filter: '',
                cvss_score: 'all',
                publicDate: 'all',
                showAll: 'False'
            },
            toolbarConfig: {}
        };
    }

    apply() {
        this.props.apply(this.state.toolbarConfig);
    }
    changeFilterValue(value) {
        let toolbarConfig = { ...this.state.toolbarConfig, filter: value };
        this.setState({ toolbarConfig });
    }

    changeCVSSValue(value) {
        this.setState({ toolbarConfig: { ...this.state.toolbarConfig, cvss_score: value } });
    }

    changeDateValue(value) {
        let toolbarConfig = { ...this.state.toolbarConfig, publicDate: value };
        this.setState({ toolbarConfig });
    }

    changeCheckboxValue(value) {
        let toolbarConfig = { ...this.state.toolbarConfig, showAll: value };
        this.setState({ toolbarConfig }, this.apply);
    }

    render() {
        let CVSSOptions = [
            { value: 'all', label: 'All', disabled: false },
            { value: 'lt4', label: 'Lower than 4', disabled: false },
            { value: '4to6', label: '4 - 6', disabled: false },
            { value: '6to8', label: '6 - 8', disabled: false },
            { value: '8to10', label: '8 - 10', disabled: false }
        ];
        let DateOptions = [{ value: 'All', label: 'All', disabled: false }, { value: 'Other', label: 'Other', disabled: false }];
        let showAll = (
            <React.Fragment>
                <br />
                <Checkbox
                    label="Display CVEs that don't affect any of my systems"
                    isChecked={this.state.toolbarConfig.showAll}
                    onChange={state => this.changeCheckboxValue(state)}
                    aria-label="controlled checkbox example"
                    id="check-1"
                />
            </React.Fragment>
        );
        return (
            <React.Fragment>
                <Toolbar className="cvetable-toolbar">
                    <ToolbarGroup className="filterCVES">
                        <ToolbarItem>
                            <SimpleTableFilter onFilterChange={this.changeFilterValue} onButtonClick={this.apply} />
                        </ToolbarItem>
                    </ToolbarGroup>
                    <ToolbarGroup className="space-between-toolbar-items">
                        <ToolbarItem>
                            <Form>
                                <FormGroup label="CVSS Base Score" fieldId="cvssScore">
                                    <Select
                                        id="cvssScore"
                                        onChange={this.changeCVSSValue}
                                        value={this.state.toolbarConfig.cvss_score}
                                    >
                                        {CVSSOptions.map((option, index) => (
                                            <SelectOption
                                                isDisabled={option.disabled}
                                                key={index}
                                                value={option.value}
                                                label={option.label}
                                            />
                                        ))}
                                    </Select>
                                </FormGroup>
                            </Form>
                        </ToolbarItem>
                        <ToolbarItem>
                            <Form>
                                <FormGroup label="Public date" fieldId="publicDate">
                                    <Select
                                        id="publicDate"
                                        value={this.state.toolbarConfig.publicDate}
                                        onChange={this.changeDateValue}
                                    >
                                        {DateOptions.map((option, index) => (
                                            <SelectOption
                                                isDisabled={option.disabled}
                                                key={index}
                                                value={option.value}
                                                label={option.label}
                                            />
                                        ))}
                                    </Select>
                                </FormGroup>
                            </Form>
                        </ToolbarItem>
                    </ToolbarGroup>
                    <ToolbarGroup className="space-between-toolbar-items">
                        <ToolbarItem>
                            <DownloadIcon size="lg" />
                        </ToolbarItem>
                        <ToolbarItem>{this.props.totalNumber} Results</ToolbarItem>
                    </ToolbarGroup>
                </Toolbar>
                {!this.props.showAllCheckbox || showAll}
            </React.Fragment>
        );
    }
}

VulnerabilitiesCveTableToolbar.propTypes = {
    CVETable: dataShape,
    fetchData: propTypes.func,
    applyToolbarConfig: propTypes.func,
    apply: propTypes.func,
    showAllCheckbox: propTypes.bool,
    totalNumber: propTypes.number
};

export default routerParams(
    connect(
        null,
        null
    )(VulnerabilitiesCveTableToolbar)
);
