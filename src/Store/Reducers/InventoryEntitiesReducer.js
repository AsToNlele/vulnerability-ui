import { find } from 'lodash';
// Initial State
const init = {
    columns: [],
    rows: [],
    entities: []
};
// Reducer

function modifyInventory(columns, data, state) {
    const customEntities = {
        columns,
        rows: [],
        entities: []
    };
    for (let apiSystem of data) {
        let inventorySystem = find(state.rows, item => item.insights_id === apiSystem.attributes.insights_id);
        if (inventorySystem) {
            inventorySystem = { ...inventorySystem, ...apiSystem.attributes };
            customEntities.rows.push(inventorySystem);
        }
    }

    customEntities.entities = customEntities.rows;
    customEntities.loaded = true;
    customEntities.count = customEntities.entities.length;

    return customEntities;
}

export const inventoryEntitiesReducer = (columns, data) => (state = init, action) => {
    switch (action.type) {
        case 'LOAD_ENTITIES_FULFILLED':
            return modifyInventory(columns, data, state);

        default:
            return state;
    }
};
